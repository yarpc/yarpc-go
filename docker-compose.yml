version: '2'

services:
    crossdock:
        image: crossdock/crossdock
        dns_search: .
        links:
            - go
            - node
            - java
            - python
            - python-sync
        environment:
            - WAIT_FOR=go,node,java,python,python-sync

            - AXIS_CLIENT=go,node,java,python,python-sync
            - AXIS_SERVER=go,node,java,python
            - AXIS_TRANSPORT=http,tchannel
            - AXIS_ENCODING=raw,json,thrift
            - AXIS_ERRORSHTTPOUT=node,go
            # AXIS_ERRORSHTTPIN TODO
            - AXIS_ERRORSTCHOUT=go
            # AXIS_ERRORSTCHIN TODO
            - AXIS_CTXCLIENT=go
            - AXIS_CTXSERVER=go
            - AXIS_GAUNTLET=go

            - BEHAVIOR_RAW=client,server,transport
            - BEHAVIOR_JSON=client,server,transport
            - BEHAVIOR_THRIFT=client,server,transport
            - BEHAVIOR_HEADERS=client,server,transport,encoding
            - BEHAVIOR_ERRORS=errorshttpout,server
            # BEHAVIOR_ERRORSHTTPIN TODO
            - BEHAVIOR_ERRORSTCHOUT=errorstchout,server
            # BEHAVIOR_ERRORSTCHIN TODO
            - BEHAVIOR_TCHCLIENT=client,server,encoding
            - BEHAVIOR_TCHSERVER=client,server,encoding
            # BEHAVIOR_HTTPCLIENT TODO
            # BEHAVIOR_HTTPSERVER TODO
            - BEHAVIOR_THRIFTGAUNTLET=gauntlet,server,transport
            - BEHAVIOR_OUTBOUNDTTL=client,server,transport
            # BEHAVIOR_INBOUNDTTL TODO
            - BEHAVIOR_CTXPROPAGATION=ctxclient,ctxserver,transport

    go:
        dns_search: .
        build: .
        ports:
            - "8080-8087"

    node:
        dns_search: .
        image: yarpc/yarpc-node
        ports:
            - "8080-8087"

    java:
        dns_search: .
        image: yarpc/yarpc-java
        ports:
            - "8080-8087"

    python:
        dns_search: .
        image: yarpc/yarpc-python
        ports:
            - "8080-8087"

    python-sync:
        dns_search: .
        image: yarpc/yarpc-python
        ports:
            - 8080
        environment:
            - SYNC=1
