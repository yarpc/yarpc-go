- [ ] Strike ResponseWriter out, use *yarpc.Response directly.
      - [x] Fix inbound middleware
      - [ ] Fix inbound transports
      - [ ] Consider creating a unified Unary or Caller interface that can be
            used for both inbound and outbound unary.
      - [x] Consider removing Body from Request and Response entirely, making
            them positional, to avoid separating and embedding Meta* for the
            streaming case.
      - [ ] Incorporate implicit buffer pooling in yarpc.Buffer (using internal/bufferpool.Buffer)
      - [ ] Now that we propogate a Response struct back, the Response should hold the actual
            application error. Errors returned by the handler (not through the Response)
            could be considered fatal (T1995085). This affects transports and encodings.
            - [ ] JSON encoding
            - [ ] HTTP transport
- [x] Change Request and Response body to yarpc.Buffer type
      - [ ] Accumulate request bodies at the inbound
- [ ] yarpcrouter.Router needs to accept middleware to decorate registered
      procedures.
- [ ] Replace functional options in yarpcpeerlist with struct options
- [ ] Create an API in yarpcfx to register and obtain peer lists by name.
      Use this API to configure the chooser for an outbound in their transport fx package.
      Use this API to send updates from a peer list updater to a peer list in the updater fx package.
- [ ] yarpchttp needs to subsume responsibility for validating requests instead
      of leaving that to middleware registered in the dispatcher.
- [ ] Consider renaming HandlerSpecs to Routes
- [ ] Fix round robin tests, relaxing its requirements regarding lifecycle
      ordering, perhaps taking availability changes into account.
- [ ] Audit yarpcerrors, remove the ones that are no longer needed.
      - [ ] add staticcheck for v2/internal/internalyarpcerror/yarpcerrors.go from `local.mk`
- [ ] Construct PRs with retroactive continuity.
- [ ] Nit: scrape name pid and change to just id throughout.
- [ ] Audit docs
      - [ ] gRPC
      - [ ] TChannel
      - [ ] HTTP
- [ ] InvokeUnaryHandler: reduce package name noise at the call site by changing to a Do(ctx) method on UnaryInvokeRequest
- [ ] support StreamHandlers in EncodingHandlerSpec
- [ ] Restore Request/Response validation, either in the transport layer or
      with middleware installed by Router (ServerProvider *cough*) and ClientProvider.
      - [ ] Inbound
            - [ ] gRPC
            - [ ] TChannel
            - [ ] HTTP
      - [ ] Outbound
            - [ ] gRPC
            - [ ] TChannel
            - [ ] HTTP
- [ ] Consider removing yarpctest.NewRequestMatcher. Requests are trivial to
      match now, except for header case mismatches.
- [ ] Visit comment in v2/yarpctest/reqres.go:
      TODO: Headers like User-Agent, Content-Length, etc. make their way to the
      user-level Request object. For now, we're doing the super set check but we
      should do something more specific once yarpc/yarpc.io#2 is resolved.

Encodings:
- [x] Drop raw encoding
- [x] Port JSON encoding
- [ ] Port Thrift encoding
      - [ ] Pull the default routing name from a Thrift annotation.
      - [ ] Add `sanitization_test.go` in plugin after TChannel is ported.
      - [ ] Revert yarpc plugin name from `thriftrw-plugin-yarpc2` to `thriftrw-plugin-yarpc`.
      - [ ] Port https://github.com/yarpc/yarpc-go/pull/1482/files into spring.
- [ ] Port / re-create Protobuf encoding
      - [x] Rewrite the protoc-gen-yarpc-go plugin.
      - [ ] Add end-to-end test that uses gRPC transport with protobuf encoding.
      - [ ] Explore threading the context in Protobuf code generation, i.e. in `Stream.Receive`.

Transports:
- [x] Port TChannel transport
      - [ ] Restore buffer pooling
      - [ ] Restore inbound_test.go
      - [ ] Restore handler_test.go
      - [ ] Restore outbound_test.go
      - [ ] Gracefully shut down: stop should block until context expires or all requests drain.
      - [ ] Add TChannel to gauntlet test
- [x] Port or recreate gRPC transport
- [ ] Use `req` and `res` as variable names for consistency.
      - [x] HTTP
      - [x] TChannel
      - [x] gRPC

Peer Lists:
- [x] Port abstract peer list to v2/yarpcpeerlist
- [ ] Port yarpcroundrobin
- [x] Port yarpcrandpeer
- [ ] Port yarpcchoiceoftwo
- [x] Port yarpcfewestpending
- [ ] Port yarpchashring32
- [ ] Remove PendingRequestCount from Status
      - [ ] pendingheap shold capture information on peerScore struct

To port peer lists forward:
- [ ] Replace functional options with options struct pattern, like net in the
      go standard library and the v2/yarpchttp example.
- [ ] Remove lifecycle.
- [ ] Drop Config and Spec, recreate in yarpcfx.
- [ ] clean up yarpctest namespace (including removing StartAction/StopAction)

To port transports forward:
- [ ] Rename Transport to Dialer, implementing yarpc.Dialer.
- [ ] Decouple Inbound and Outbound from Transport. The Dialer gives outbounds
      access to the underlying transport if that's needed to convey disconnect
      messages back.  Inbounds have no need for the dialer.
- [ ] Remove lifecycle.
- [ ] Inbounds should have Addr and Listener properties, favoring the open Listener if given.
- [ ] Outbounds should have URL/Addr, Dialer, and Chooser properties, favoring the Chooser if given.
- [ ] NewSingleOutbound should be removed in favor of Outbound{Dialer, Addr or URL} as an alternative
      to providing a chooser.
- [ ] Start/Stop must accept context, return error.
- [ ] Replace functional options with options struct pattern, like net in the
      go standard library and the v2/yarpchttp example.
- [ ] Transports() method is no longer required.
- [ ] Reduce the Connecting peer connection status to simply Unavailable.
- [ ] Clean up free variables that refer to dialers. What was trans, x, or transport can now be just dialer.
- [ ] Remove all references to the raw encoding in tests, which no longer exists.
- [ ] Stop with context should block until context expires or all connection management goroutines conclude.
- [ ] Nit: reg as a free variable should be renamed router.
- [ ] Audit docs
- [ ] Nit: eliminate use of "." imports for yarpctests.
- [ ] Replace the Dispatcher throughout tests with a yarpc.Router or yarpc.Config as needed.

To port encodings forward:
- [ ] Accept yarpc/v2.Client instead of yarpc.ClientConfig + yarpc.Outbounds.
- [ ] Create new codegen target for yarpc/v2
- [ ] New encodings must accept middleware stack in client constructor
- [ ] Replace the Dispatcher throughout tests with a yarpc.Router or yarpc.Config as needed.
- [ ] Audit docs
- [ ] Nit: eliminate use of "." imports for yarpctests.

Package changes:
- [x] yarpcconfig -> /dev/null
- [ ] api/transport -> v2
- [ ] api/peer -> v2
- [ ] api/middleware -> v2
- [ ] yarpcerrors -> v2/yarpcerror
- [ ] yarpctest -> v2/yarpctest
- [ ] api/transport/transporttest -> v2/yarpctest
- [ ] api/peer/peertest -> v2/yarpctest
- [ ] peer/peerlist/v2 -> v2/yarpcpeerlist
- [ ] intyarpcerrors yarpc/internal/yarpcerrors -> yarpc/v2/internal/internalyarpcerrors

Name changes
- [ ] {Mock,}{Unary,Stream}Handler -> {Mock,}{Unary,Stream}Transport{Handler,Middleware}
- [ ] api/transport.* -> v2.*
- [ ] api/transport/transporttest.* -> v2/yarpctest.*
- [ ] api/peer.* -> v2.*
- [ ] api/peer/peertest.* -> v2/yarpctest.*
- [x] api/middleware.* -> v2/yarpcmiddlware.*
- [ ] api/middleware/middlewaretest.* -> v2/yarpcmiddlewaretest.*
- [ ] transport/* -> v2/yarpc*
- [ ] encoding/* -> v2/yarpc*
- [ ] yarpc.ErrTansportHasNoReferenceToPeer -> yarpcpeer.ErrDialerHasNoReferenceToPeer
- [ ] pkg/errors.WrapHandlerError -> v2/yarpcerrors.WrapHandlerError
- [ ] peer/hostport.PeerIdentifier -> v2.Address
- [ ] peer/hostport.Peer -> v2/yarpcpeer.AbstractPeer
- [ ] yarpc.OpentracingTags -> v2/yarpctracing.Tags
- [ ] internal/errors.ZeroAddrToHostPort -> v2/internal/internalyarpcerrors.ZeroAddrToHostPort
- [ ] internal/iopool -> v2/internal/internaliopool
- [ ] TransportAction -> DialerAction
- [ ] ApplyTransportActions -> ApplyDialerActions
- [ ] peer.Single -> no longer needed
- [ ] peer.Binder -> no longer needed
- [ ] internal/testtime -> v2/internal/internaltesttime
